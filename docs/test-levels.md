# テストレベル定義

**作成日:** 2025-10-11
**バージョン:** 1.0

---

## テストレベルの定義

携帯電話料金計算システムのテストにおいて、以下のテストレベルを定義します。

### 1. 単体テスト (Unit Test)

**目的:**
個々の計算ロジック・関数が正しく動作することを確認する

**対象:**
- 単一の計算関数・モジュール
- 外部依存を持たない独立した処理単位

**実施者:**
開発者

**例:**
- 日割り計算関数単体
- 消費税計算関数単体
- 四捨五入処理の関数単体

---

### 2. 結合テスト (Integration Test)

**目的:**
複数のモジュール・コンポーネントを組み合わせた処理が正しく連携することを確認する

**対象:**
- 複数の計算ロジックを組み合わせた処理
- モジュール間のインターフェース
- データの受け渡し

**実施者:**
開発者・テスター

**例:**
- 基本料金 + データ料金 + オプション料金の合算処理
- 割引適用後の料金計算
- プラン選択から料金確定までの一連の処理

---

### 3. システムテスト (System Test)

**目的:**
システム全体として仕様要件を満たしていることを確認する

**対象:**
- エンドツーエンドのシナリオ
- ユーザー視点での利用フロー
- 実際の業務プロセス

**実施者:**
テスター・QAチーム

**例:**
- 新規契約から初回請求までの全プロセス
- 長期利用における割引適用の時系列変化
- プラン変更時の料金計算

---

### 4. 受け入れテスト (Acceptance Test)

**目的:**
システムがビジネス要件を満たし、実運用に耐えうることを確認する

**対象:**
- ビジネス要件の充足
- 実際の運用シナリオ
- ユーザー受け入れ基準

**実施者:**
発注者・ビジネスオーナー・ユーザー代表

**例:**
- 実際の顧客データを使った料金計算の妥当性確認
- 現行システムとの計算結果比較
- 法規制・会計基準への適合確認

---

## テストレベルの選択基準

| テストレベル | 粒度 | 依存関係 | 実施タイミング | 自動化 |
|------------|------|---------|--------------|--------|
| 単体テスト | 小（関数） | なし | 開発中・随時 | 推奨 |
| 結合テスト | 中（モジュール連携） | あり（内部） | 機能実装後 | 推奨 |
| システムテスト | 大（全体） | あり（全体） | システム構築後 | 部分的 |
| 受け入れテスト | 大（業務視点） | あり（全体） | リリース前 | 不要 |

---

## 本プロジェクトにおけるテストレベルの適用

料金計算システムは**計算ロジックが主体**のシステムであり、以下の観点で整理します：

### 前提
- 仕様書には計算ロジックのみ記載されている
- UI/画面仕様は未定義
- システムアーキテクチャは不明

### 本プロジェクトでのテストレベル定義

#### 単体テスト
- **対象:** 個別の料金計算ロジック
- **例:** 日割り計算、消費税計算、SMS文字数→通数変換

#### 結合テスト
- **対象:** 複数の料金要素を組み合わせた計算
- **例:** プラン料金 + オプション - 割引 の合算、月またぎ通話の請求月判定

#### システムテスト
- **対象:** エンドツーエンドのシナリオ
- **例:** 契約から請求までの時系列シナリオ、プラン変更時の料金変動

---

## 各テストカテゴリのテストレベル割り当て

以下の表は、17のテストカテゴリに対して推奨するテストレベルを示します。

| # | テストカテゴリ | 単体 | 結合 | システム | 理由 |
|---|-------------|------|------|---------|------|
| 1 | プラン選択 | - | ● | ○ | 複数料金要素の組み合わせ計算 |
| 2 | 通話料金計算 | ● | ○ | - | 個別の料金計算ロジック |
| 3 | 無料通話対象外番号 | ● | ○ | - | 電話番号による分岐処理 |
| 4 | SMS料金計算 | ● | ○ | - | 文字数→通数変換ロジック |
| 5 | データ通信量 | ● | ○ | - | 使用量による段階判定ロジック |
| 6 | 日割り計算 | ● | ○ | - | 日割り計算関数の動作確認 |
| 7 | 割引適用ロジック | - | ● | ○ | 時系列による状態変化 |
| 8 | 契約解除料 | ● | ○ | - | 契約期間による判定ロジック |
| 9 | オプションサービス | - | ● | ○ | 無料期間の状態遷移 |
| 10 | データ関連オプション | ● | ○ | - | 容量計算と優先順位ロジック |
| 11 | データ快適モード回数設定 | ● | ○ | - | 回数制御ロジック |
| 12 | 事務手数料 | ● | ○ | - | 初回判定ロジック |
| 13 | 初回請求合算 | - | ● | ○ | 複数料金要素の合算 |
| 14 | 消費税計算 | ● | ○ | - | 税額計算と四捨五入ロジック |
| 15 | E2Eシナリオ | - | - | ● | エンドツーエンドの業務フロー |
| 16 | 異常系 | ● | ○ | ○ | 全レベルでエラーハンドリング確認 |
| 17 | リグレッション | - | ● | ● | 変更による既存機能への影響確認 |

**凡例:**
- ●: 主にこのレベルで実施
- ○: 補助的に実施
- -: 該当なし

---

## テストレベル別のテストケース配分

### 単体テスト中心（10カテゴリ）
計算ロジックの正確性を確認
- 通話料金計算、SMS料金計算、データ通信量、日割り計算、契約解除料、データ関連オプション、データ快適モード、事務手数料、消費税計算、無料通話対象外番号

**推定ケース数:** 約70ケース

---

### 結合テスト中心（5カテゴリ）
複数要素の組み合わせと状態遷移を確認
- プラン選択、割引適用ロジック、オプションサービス、初回請求合算、リグレッション

**推定ケース数:** 約50ケース

---

### システムテスト中心（2カテゴリ）
エンドツーエンドのシナリオを確認
- E2Eシナリオ、異常系（一部）

**推定ケース数:** 約15ケース

---

## テスト実施順序

### フェーズ1: 単体テスト
1. 基礎的な計算ロジック（日割り、消費税、SMS文字数変換）
2. 個別料金計算（通話、データ、オプション）
3. 判定ロジック（契約解除料、データ段階判定）

### フェーズ2: 結合テスト
1. プラン選択と料金合算
2. 割引適用と期間管理
3. 初回請求合算

### フェーズ3: システムテスト
1. エンドツーエンドシナリオ
2. 異常系・エラーハンドリング
3. リグレッション

---

## まとめ

料金計算システムのテストでは、以下の配分を推奨します：

| テストレベル | ケース数 | 割合 | 重点 |
|------------|---------|------|------|
| 単体テスト | 約70ケース | 50% | 計算ロジックの正確性 |
| 結合テスト | 約50ケース | 35% | 複数要素の組み合わせ |
| システムテスト | 約15ケース | 15% | エンドツーエンド |

**総計:** 約135ケース
